---
title: "Fuel Data analysis"
output: html_notebook
---

#### Fuel consumption sensor
```{r}
fuelUsed <- read.csv("FuelUsed.csv", header=T, sep=";")
head(fuelUsed)
```
Fuel comsuption data procesing

```{r}
x <- fuelUsed$Fecha.de.Recepción
x <- strptime(x, "%d/%m/%Y %H:%M")
head(x)
y <- fuelUsed$Valor

```

Ploting fuel comsuption sensor

```{r}
plot(x,y,xaxt="n", type= "l",col="green")
axis.POSIXct(1,at=x,labels=format(x,"%d-%H:%M"),las=2)
```

Calculation of the fuel consumption 

```{r}

consumed <- max(y) - min(y)
cat("Fuel consumed: ",consumed, "GAL(US)")

```

#### Fuel Level sensor


```{r}
Level <- read.csv("Level.csv", header=T, sep=";")
head(Level)
```

#### Fuel level Data analysis


Procesing data from just 1 day (December 07)

```{r}

x <- strptime(Level$Fecha.de.Recepción, "%d/%m/%Y %H:%M");
x <- x[1:367]
y <- Level$Valor[1:367]

```

Ploting Fuel sensor Data (December 07)

```{r}
plot(x,y,xaxt="n", type= "l",col="green")
axis.POSIXct(1,at=x,labels=format(x,"%d-%H:%M"),las=2)
```

Searching for skewness and abnormal data

```{r}
boxplot(y)
hist(y)
```

**Moving average(mean) filter (MMF) fuction**

```{r}

### This fuction creates a Moving average(mean) filter (MMF)
### Only use the 4 close neighbors
### average is taked from 5 values

### td, date and time of the sensor
### sensor, sensor data

MMF <- function (td,sensor){
  
  
  meanFilter <- c()
  
  for (i in 3:length(sensor)) {
  
  ini <- i+2
  end <- i-2
  meanFilter[i] <- mean(sensor[ini:end])
  
}

plot(td,meanFilter,xaxt="n", type= "l",col="green")
axis.POSIXct(1,at=td,labels=format(td,"%d-%H:%M"),las=2)

return(meanFilter)  
  
}
```


Using mean filter on the Fuel sensor data from (December 07)

```{r}

x <- x[1:367]
y <- Level$Valor[1:367]

MMF_y <- MMF(x,y)
head(MMF_y)
```


** Deleting abnormal data remplacing with the mean**

```{r}
y_fixed <- c()

for (i in 1:length(y)) {
  
  if (y[i] > 40){
    
    y_fixed[i] <- mean(y)
    
  }else{
    
    y_fixed[i] <- y[i]
    
  }
  
}

plot(x,y_fixed,xaxt="n", type= "l",col="green")
axis.POSIXct(1,at=x,labels=format(x,"%d-%H:%M"),las=2)

```

Aplaying median filter to the data.

```{r}
MMF_y_fixed <- MMF(x,y_fixed)
head(MMF_y_fixed )

boxplot(MMF_y_fixed )
hist(MMF_y_fixed )
a <- MMF_y_fixed [3:365]
max(a)-min(a)
```




